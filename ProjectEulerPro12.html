<html>
<head>
    <title>ProjectEulerPro12</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="Stylesheet" type="text/css" href="assets/styles/style.css" />
    <script src="assets/js/jquery.js" type="text/javascript"></script>
    <script>
        var root_path = "";
    </script>

</head>
<body>
    <div id="all">
        <div id="header"></div>
        <div id="main">
            
<h1 id="toc_1">Project Euler Problem 12</h1>

<h2 id="toc_1.1">Description</h2>
<p>
The sequence of triangle numbers is generated by adding the natural numbers. So the 7th triangle number would be 1 + 2 + 3 + 4 + 5 + 6 + 7 = 28. The first ten terms would be:
</p>

<pre>
    1, 3, 6, 10, 15, 21, 28, 36, 45, 55, ...
</pre>
<p>
Let us list the factors of the first seven triangle numbers:
</p>
<pre>
 1: 1
 3: 1,3
 6: 1,2,3,6
10: 1,2,5,10
15: 1,3,5,15
21: 1,3,7,21
28: 1,2,4,7,14,28
</pre>
<p>
We can see that 28 is the first triangle number to have over five divisors.
</p>

<p>
What is the value of the first triangle number to have over five hundred divisors?
</p>


<h2 id="toc_1.2">Solution</h2>
<p>
题目要求第一个含有超过500（包含）个因数的三角形数。
</p>

<p>
对于任意一个数，都可以表示以下形式：
</p>
\[
N = p_{1}^{a_1} * p_{2}^{a_2} * p_{3}^{a_3} * ... 
\]
<p>
其中，\( p_n \)是不同的质数，\( a_n \)是它们的指数。
</p>

<p>
另D(N)代表N所含的因子个数，那么D(N)可以表示为以下形式：
</p>
\[
D(N) = (a_1+1) * (a_2+1) * (a_3+1) * ...
\]
<p>
所以我们可以依次枚举每个三角形数，然后分解成质因式，从而求出所含的因数个数，直到求出第一个因数个数超过500的三解形数。
可能的算法如下：
</p>
<pre class="brush: python">
def first_triangle_num_over_n_divisors(n):
    prime = prime_init(10000)
    triangle = 1
    res = 1
    for i in range(2, 10000001):
        triangle += i
        if count_divisors(triangle, prime) &gt;= n:
            res = triangle
            break
    return res
</pre>
<p>
其中，<code>prime_init</code>初始1000000以内的素数列表，<code>count_divisors</code>计算每个三角形数的因素个数。
</p>

<p>
这个算法还有改进的余地，注意到三角形数可以表示为\( t = n * (n+1) / 2 \)，因为n和n+1互质，那么D(t)可以表示为：
</p>
\[
D(t) = D(n/2) * D(n+1)\ \ if\ n\ is\ even \\
D(t) = D(n) * D((n+1)/2)\ \ if\ n+1\ is\ even
\]
<p>
所以我们只需要计算n和n+1的因数个数，即可求出对应的三角形数的因数个数，通过迭代的方法，计算量由\( O(n) \)减少到\( O(\sqrt{n}) \)。
</p>
<h2 id="toc_1.3">Code</h2>
<pre class="brush: python;">
#!/usr/bin/python3
# -*- coding: utf-8 -*-

import math
from timeit import Timer

def prime_init(n):
    sievebound = (n-1) // 2
    sieve = [False] * (sievebound + 2)
    crosslimit = (int(math.sqrt(n))-1) // 2
    for i in range(1, crosslimit+1):
        if not sieve[i]:
            for j in range(2*i*(i+1), sievebound+1, 2*i+1):
                sieve[j] = True
    return [2]+[2*i+1 for i in range(1, sievebound+1) if not sieve[i]]

def count_divisors(n, prime):
    num = 1
    for i in prime:
        if i * i &gt; n:
            num *= 2
            break
        j = 1
        while n % i == 0:
            n //= i
            j += 1
        num *= j
        if n == 1:
            break
    return num

def first_triangle_num_over_n_divisors(n):
    prime = prime_init(10000)
    triangle = 1
    res = 1
    for i in range(2, 10000001):
        triangle += i
        if count_divisors(triangle, prime) &gt;= n:
            res = triangle
            break
    return res

def first_triangle_num_over_n_divisors_fast(n):
    prime = prime_init(1000)
    res = 1
    prev_num = 1
    for i in range(2, 20000):
        num = count_divisors(i//2 if i%2==0 else i, prime)
        if prev_num * num &gt;= n:
            res = i * (i-1) // 2
            break
        prev_num = num
    return res

if __name__ == "__main__":
    t1 = Timer("first_triangle_num_over_n_divisors(500)", "from __main__ import first_triangle_num_over_n_divisors")
    t2 = Timer("first_triangle_num_over_n_divisors_fast(500)", "from __main__ import first_triangle_num_over_n_divisors_fast")
    print(t1.timeit(1), t2.timeit(1))
    #print(first_triangle_num_over_n_divisors(500))
    #print(first_triangle_num_over_n_divisors_fast(500))

</pre>
<hr />
<p>
<code>History</code>:
</p>
<ul>
<li>
2012-03-09 23:22 add

</ul>

        </div>
        <div id="sidebar"></div>
        <div id="footer"></div>
    </div>
    <script src="assets/js/itcbxwiki.js" type="text/javascript"></script>
</body>
</html>
